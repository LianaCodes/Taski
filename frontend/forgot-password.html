<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password - Taski</title>
  <meta name="description" content="Reset your Taski password.">
  <meta property="og:title" content="Forgot Password — Taski">
  <meta property="og:description" content="Reset your password to access your study planner.">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-login">
  <main class="center-page">
    <div id="notification" class="notification"></div>
    <div class="glass-card login-card">
      <div class="logo"><img src="logo.svg" alt="Taski logo" class="logo-img-small"></div>
      <h1 class="card-title">Reset Password</h1>
      <p class="card-sub">Enter your email to receive a reset link</p>

      <form id="forgot-password-form" class="card-form">
        <label class="sr-only" for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email" required autocomplete="email">

        <button type="submit" class="btn btn-gradient">Send Reset Link</button>
      </form>

      <div id="success-message" class="success-message" style="display: none;">
        <p>✅ If an account with that email exists, we've sent you a password reset link.</p>
        <p>Please check your email and follow the instructions.</p>
      </div>

      <p class="muted"><a href="login.html">← Back to Login</a></p>
    </div>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 4000);
    }

    // Initialize Firebase
    if (window.firebaseConfig && !firebase.apps.length) {
      firebase.initializeApp(window.firebaseConfig);
    }
    const auth = firebase.auth();

    document.getElementById('forgot-password-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const form = document.getElementById('forgot-password-form');
      const successMessage = document.getElementById('success-message');

      try {
        // Use Firebase to send password reset email
        await auth.sendPasswordResetEmail(email);
        
        // Always show success (don't reveal if account exists)
        form.style.display = 'none';
        successMessage.style.display = 'block';

      } catch (error) {
        console.error('Forgot password error:', error);
        
        // Still show success message to not reveal if account exists
        if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-email') {
          form.style.display = 'none';
          successMessage.style.display = 'block';
        } else if (error.code === 'auth/too-many-requests') {
          showNotification('Too many requests. Please try again later.', 'error');
        } else {
          showNotification('Something went wrong. Please try again.', 'error');
        }
      }
    });
  </script>
</body>
</html>
